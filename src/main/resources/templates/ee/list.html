<!doctype html>
<html lang="en">
<head>

    <!--  Зависимости Bootstrap-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link th:href = "@{/css/bootstrap.min.css}" rel="stylesheet">
    <script th:src="@{/umd/popper.min.js}"></script>
    <script th:src="@{/js/bootstrap.min.js}"></script>
    <title>HoursMeter</title>
    <style>
        .table-hover tbody tr:hover {
            background-color: #e0ecff;
        }
    </style>
</head>
<body>
<div class="container-fluid p-0">
    <header th:insert="blocks/header :: header"></header>
    <div class="container">
        <div class="mb-3" th:if="${not #lists.isEmpty(errorMessage)}" id="error-message">
            <h6 class="text-danger" th:text="${errorMessage}"></h6>
        </div>
        <div class="mb-3" th:if="${not #lists.isEmpty(message)}" id="success-message">
            <h6 class="text-success" th:text="${message}"></h6>
        </div>
        <div class="row mx-0">
            <table class="table table-hover">
                <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">Работодатель</th>
                    <th scope="col">Сотрудник</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="ee, iterStat: ${employersEmployees}"
                    th:attr="data-role=${session.user.authority.authority}, data-id=${ee.id}"
                    style="cursor: pointer;">
                    <td th:text="${iterStat.index + 1}"></td>
                    <td th:text="${ee.employer.getSurname()}"></td>
                    <td th:text="${ee.employee.getSurname()}"></td>
                </tr>
                </tbody>
            </table>
            <div class="container">
                <div class="row">
                    <a class="btn btn-primary w-100" th:href="@{/bind}">
                        Привязать пользователя &nbsp;&nbsp;&nbsp;
                        <i class="fa fa-plus"></i>
                    </a>
                </div>
            </div>
        </div>
    </div>
    <div class="bg-light sticky-bottom">
        <footer th:insert="blocks/footer :: footer"></footer>
    </div>
</div>
<script>
    function hideMessages() {
        const errorMessage = document.getElementById('error-message');
        const successMessage = document.getElementById('success-message');

        if (errorMessage) {
            setTimeout(() => {
                errorMessage.style.display = 'none';
            }, 3000);
        }
        if (successMessage) {
            setTimeout(() => {
                successMessage.style.display = 'none';
            }, 3000);
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        var rows = document.querySelectorAll("tbody tr");
        rows.forEach(function(row) {
            row.addEventListener("click", function() {
                var href = row.getAttribute("href");
                var eeId = row.getAttribute("data-id");
                var userRole = row.getAttribute("data-role");
                if ((userRole !== 'ROLE_EMPLOYER') && (userRole !== 'ROLE_USER')) {
                    window.location.href = '/unbind?id=' + eeId;
                }
            });
        });
    });

    window.onload = hideMessages;
</script>
</body>
</html>